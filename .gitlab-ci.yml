stages:
    - test
    - deploy

variables:
    APP_NAME: nuxt-full-stack

test_client:
    stage: test
    image: node:latest
    cache:
        paths:
            - node_modules/
    script:
        - npm install
        - npm run test-client

test_server:
    stage: test
    image: node:latest
    cache:
        paths:
            - node_modules/
    script:
        - npm install
        - npm run test-server

deploy:
    stage: deploy
    image: ilyasemenov/gitlab-ci-git-push
    environment:
        name: production
        url: https://$APP_NAME.dokku.online/
    only:
        - master
    script:
        - git-push ssh://dokku@dokku.online:22/$APP_NAME
